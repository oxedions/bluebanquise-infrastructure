

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>5. Configure BlueBanquise &mdash; BlueBanquise Documentation 1.0.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'./',
              VERSION:'1.0.1',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="6. Deploy BlueBanquise" href="deploy_bluebanquise.html" />
    <link rel="prev" title="4. Learn Ansible" href="learn_ansible.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> BlueBanquise Documentation
          

          
            
            <img src="_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="vocabulary.html">2. Vocabulary</a></li>
<li class="toctree-l1"><a class="reference internal" href="install_first_management.html">3. Install first management</a></li>
<li class="toctree-l1"><a class="reference internal" href="learn_ansible.html">4. Learn Ansible</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">5. Configure BlueBanquise</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#get-bluebanquise">5.1. Get BlueBanquise</a></li>
<li class="toctree-l2"><a class="reference internal" href="#configure-inventory">5.2. Configure inventory</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#important-before-we-start">5.2.1. Important before we start</a></li>
<li class="toctree-l3"><a class="reference internal" href="#check-example-inventory">5.2.2. Check example inventory</a></li>
<li class="toctree-l3"><a class="reference internal" href="#review-nodes">5.2.3. Review nodes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#management-node">5.2.3.1. Management node</a></li>
<li class="toctree-l4"><a class="reference internal" href="#other-nodes">5.2.3.2. Other nodes</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#review-logical-networks">5.2.4. Review logical networks</a></li>
<li class="toctree-l3"><a class="reference internal" href="#review-general-configuration">5.2.5. Review general configuration</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#externals">5.2.5.1. Externals</a></li>
<li class="toctree-l4"><a class="reference internal" href="#network">5.2.5.2. Network</a></li>
<li class="toctree-l4"><a class="reference internal" href="#repositories">5.2.5.3. Repositories</a></li>
<li class="toctree-l4"><a class="reference internal" href="#nfs">5.2.5.4. NFS</a></li>
<li class="toctree-l4"><a class="reference internal" href="#general">5.2.5.5. General</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#review-default-parameters">5.2.6. Review Default parameters</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#equipment-profile">5.2.6.1. Equipment profile</a></li>
<li class="toctree-l4"><a class="reference internal" href="#authentication">5.2.6.2. Authentication</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#review-groups-parameters">5.2.7. Review groups parameters</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="deploy_bluebanquise.html">6. Deploy BlueBanquise</a></li>
<li class="toctree-l1"><a class="reference internal" href="multiple_icebergs.html">7. Manage multiple icebergs</a></li>
<li class="toctree-l1"><a class="reference internal" href="roles.html">8. Roles</a></li>
<li class="toctree-l1"><a class="reference internal" href="references.html">9. References</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">BlueBanquise Documentation</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>5. Configure BlueBanquise</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/configure_bluebanquise.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="configure-bluebanquise">
<h1>5. Configure BlueBanquise<a class="headerlink" href="#configure-bluebanquise" title="Permalink to this headline">¶</a></h1>
<p>At this point, you should have an operating system with Ansible installed on it, and basic OS repositories.</p>
<div class="section" id="get-bluebanquise">
<h2>5.1. Get BlueBanquise<a class="headerlink" href="#get-bluebanquise" title="Permalink to this headline">¶</a></h2>
<p>Install needed basic packages:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>yum install wget createrepo git
</pre></div>
</div>
<p>Now, download latest <strong>BlueBanquise</strong> version from git:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>git clone https://github.com/bluebanquise/bluebanquise.git /etc/bluebanquise
</pre></div>
</div>
<p>ansible will read ANSIBLE_CONFIG, ansible.cfg in the current working directory, .ansible.cfg in the home directory or /etc/ansible/ansible.cfg, whichever it finds first.</p>
<p>To use /etc/bluebanquise/ansible.cfg, either change the current working directory or set ANSIBLE_CONFIG:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">ANSIBLE_CONFIG</span><span class="o">=</span>/etc/bluebanquise/ansible.cfg
<span class="nb">cd</span> /etc/bluebanquise
</pre></div>
</div>
<p>Finally, edit /etc/hosts file, and add “management1” (or whatever your current management node hostname) on localhost line:</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4 management1
::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
</pre></div>
</div>
<p>It is time to configure the inventory to match cluster needs.</p>
</div>
<div class="section" id="configure-inventory">
<h2>5.2. Configure inventory<a class="headerlink" href="#configure-inventory" title="Permalink to this headline">¶</a></h2>
<p>This documentation will cover the configuration of a very simple cluster:</p>
<img alt="_images/example_cluster_small.svg" src="_images/example_cluster_small.svg" /><div class="section" id="important-before-we-start">
<h3>5.2.1. Important before we start<a class="headerlink" href="#important-before-we-start" title="Permalink to this headline">¶</a></h3>
<p>Ansible will read <strong>ALL</strong> files in the inventory. <strong>NEVER do a backup of a file here!</strong></p>
<p>Backup in another location, outside of /etc/bluebanquise/inventory.</p>
</div>
<div class="section" id="check-example-inventory">
<h3>5.2.2. Check example inventory<a class="headerlink" href="#check-example-inventory" title="Permalink to this headline">¶</a></h3>
<p>An inventory example is provided in /etc/bluebanquise/resources/examples/simple_cluster/ as a base for our work.</p>
<p>This example is based on the picture provided just above.</p>
<p>Lets copy it to use it as our new inventory:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>cp -a /etc/bluebanquise/resources/examples/simple_cluster/inventory /etc/bluebanquise/inventory
</pre></div>
</div>
</div>
<div class="section" id="review-nodes">
<h3>5.2.3. Review nodes<a class="headerlink" href="#review-nodes" title="Permalink to this headline">¶</a></h3>
<p>Time to review the provided example configuration, and adapt it to your configuration.</p>
<p>First, the nodes.</p>
<div class="section" id="management-node">
<h4>5.2.3.1. Management node<a class="headerlink" href="#management-node" title="Permalink to this headline">¶</a></h4>
<p>Open file cluster/nodes/managements.yml:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">mg_managements</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">children</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">equipment_typeM</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">hosts</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">management1</span><span class="p p-Indicator">:</span>
          <span class="l l-Scalar l-Scalar-Plain">bmc</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">bmanagement1</span>
            <span class="l l-Scalar l-Scalar-Plain">ip4</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">10.10.100.1</span>
            <span class="l l-Scalar l-Scalar-Plain">mac</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">08:00:27:dc:f8:f6</span>
            <span class="l l-Scalar l-Scalar-Plain">network</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ice1-1</span>
          <span class="l l-Scalar l-Scalar-Plain">network_interfaces</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">enp0s3</span><span class="p p-Indicator">:</span>
              <span class="l l-Scalar l-Scalar-Plain">ip4</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">10.10.0.1</span>
              <span class="l l-Scalar l-Scalar-Plain">mac</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">08:00:27:dc:f8:f5</span>
              <span class="l l-Scalar l-Scalar-Plain">network</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ice1-1</span>
            <span class="l l-Scalar l-Scalar-Plain">ib0</span><span class="p p-Indicator">:</span>
              <span class="l l-Scalar l-Scalar-Plain">ip4</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">10.20.0.1</span>
              <span class="l l-Scalar l-Scalar-Plain">network</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">interconnect-1</span>
</pre></div>
</div>
<p>This file contains our management node configuration. Let’s review it, to understand it.</p>
<p>First, the groups:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">mg_managements</span><span class="p p-Indicator">:</span>         <span class="c1"># This is the main group (also called master group), it is very useful with advanced configuration</span>
  <span class="l l-Scalar l-Scalar-Plain">children</span><span class="p p-Indicator">:</span>             <span class="c1"># This is an Ansible instruction, indicating the below group is included in mg_managements group</span>
    <span class="l l-Scalar l-Scalar-Plain">equipment_typeM</span><span class="p p-Indicator">:</span>    <span class="c1"># This is the equipment group of the management node. It always starts by &#39;equipment_&#39;</span>
      <span class="l l-Scalar l-Scalar-Plain">hosts</span><span class="p p-Indicator">:</span>            <span class="c1"># This is an Ansible instruction, to list below the hosts member of this group</span>
        <span class="l l-Scalar l-Scalar-Plain">management1</span><span class="p p-Indicator">:</span>    <span class="c1"># This is the hostname</span>
</pre></div>
</div>
<p>Now the BMC (if exist):</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">mg_managements</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">children</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">equipment_typeM</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">hosts</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">management1</span><span class="p p-Indicator">:</span>
          <span class="l l-Scalar l-Scalar-Plain">bmc</span><span class="p p-Indicator">:</span>                      <span class="c1"># This instruction defines an attached BMC</span>
            <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">bmanagement1</span>      <span class="c1"># This is the hostname of the BMC</span>
            <span class="l l-Scalar l-Scalar-Plain">ip4</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">10.10.100.1</span>        <span class="c1"># This is the ipv4 of the BMC</span>
            <span class="l l-Scalar l-Scalar-Plain">mac</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">08:00:27:dc:f8:f6</span>  <span class="c1"># This is the MAC hardware address of the BMC (for DHCP)</span>
            <span class="l l-Scalar l-Scalar-Plain">network</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ice1-1</span>         <span class="c1"># This is the logical network this interface is connected to. Logical networks will be seen later.</span>
</pre></div>
</div>
<p>Then the network interfaces and their associated networks:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">mg_managements</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">children</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">equipment_typeM</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">hosts</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">management1</span><span class="p p-Indicator">:</span>
          <span class="l l-Scalar l-Scalar-Plain">bmc</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">bmanagement1</span>
            <span class="l l-Scalar l-Scalar-Plain">ip4</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">10.10.100.1</span>
            <span class="l l-Scalar l-Scalar-Plain">mac</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">08:00:27:dc:f8:f6</span>
            <span class="l l-Scalar l-Scalar-Plain">network</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ice1-1</span>
          <span class="l l-Scalar l-Scalar-Plain">network_interfaces</span><span class="p p-Indicator">:</span>         <span class="c1"># This is an instruction, to define bellow all host&#39;s NIC (Network Interface Controllers)</span>
            <span class="l l-Scalar l-Scalar-Plain">enp0s3</span><span class="p p-Indicator">:</span>                   <span class="c1"># This is the NIC name (&#39;ip a&#39; command to get NIC list)</span>
              <span class="l l-Scalar l-Scalar-Plain">ip4</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">10.10.0.1</span>          <span class="c1"># This is the expected ipv4 for this NIC</span>
              <span class="l l-Scalar l-Scalar-Plain">mac</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">08:00:27:dc:f8:f5</span>  <span class="c1"># This is the NIC MAC address, for the DHCP</span>
              <span class="l l-Scalar l-Scalar-Plain">network</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ice1-1</span>         <span class="c1"># This is the logical network this interface is linked to</span>
            <span class="l l-Scalar l-Scalar-Plain">ib0</span><span class="p p-Indicator">:</span>                      <span class="c1"># This is another interface, not in the dhcp so no MAC is provided</span>
              <span class="l l-Scalar l-Scalar-Plain">ip4</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">10.20.0.1</span>
              <span class="l l-Scalar l-Scalar-Plain">network</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">interconnect-1</span>
</pre></div>
</div>
<p>It should not be too difficult to understand this file.</p>
</div>
<div class="section" id="other-nodes">
<h4>5.2.3.2. Other nodes<a class="headerlink" href="#other-nodes" title="Permalink to this headline">¶</a></h4>
<p>Now, review computes nodes and logins nodes in respectively files cluster/nodes/computes.yml and cluster/nodes/logins.yml. Same rules apply. You can also add more nodes, or if you have for example multiple type of equipment for computes nodes or login nodes, add another equipment group this way:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">mg_computes</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">children</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">equipment_typeC</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">hosts</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">c001</span><span class="p p-Indicator">:</span>
        <span class="p p-Indicator">[</span><span class="nv">...</span><span class="p p-Indicator">]</span>
    <span class="l l-Scalar l-Scalar-Plain">equipment_typeD</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">hosts</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">c005</span><span class="p p-Indicator">:</span>
        <span class="p p-Indicator">[</span><span class="nv">...</span><span class="p p-Indicator">]</span>
    <span class="l l-Scalar l-Scalar-Plain">equipment_typeE</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">hosts</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">c010</span><span class="p p-Indicator">:</span>
        <span class="p p-Indicator">[</span><span class="nv">...</span><span class="p p-Indicator">]</span>
</pre></div>
</div>
<p>Now, let’s have a look at the logical networks.</p>
</div>
</div>
<div class="section" id="review-logical-networks">
<h3>5.2.4. Review logical networks<a class="headerlink" href="#review-logical-networks" title="Permalink to this headline">¶</a></h3>
<p>In <strong>BlueBanquise</strong>, nodes are connected together through logical network. Most of the time, logical networks will match your physical network, but for advanced networking, it can be different.</p>
<p>All networks are defined in group_vars/all/networks directory, with one file per network. In this current example inventory, there are two networks provided: ice1-1 and interconnect-1.</p>
<p>Before reviewing the file, please read this <strong>IMPORTANT</strong> information: in <strong>BlueBanquise</strong> there are two kind of networks: administration networks, and the others.</p>
<p>An administration network is used to deploy and manage the nodes. It will be for example used to run a DHCP server, handle the PXE stack, etc, and also all the Ansible ssh connections. Administration networks have a strict naming convention, which by default is: <strong>iceX-Y</strong> with X the iceberg number, and Y the subnet number in this iceberg X. In our case, we are working on iceberg1 (default when disabling icebergs mechanism), and we only have one subnet, so our administration network will be ice1-1. If we would need another subnet, its name would have been ice1-2, etc. Interconnect-1 is not an administration network.</p>
<p>Open file group_vars/all/networks/ice1-1.yml and let’s check its content:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">networks</span><span class="p p-Indicator">:</span>                                             <span class="c1"># This defines a new network</span>
  <span class="l l-Scalar l-Scalar-Plain">ice1-1</span><span class="p p-Indicator">:</span>                                             <span class="c1"># Network name</span>
    <span class="l l-Scalar l-Scalar-Plain">subnet</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">10.10.0.0</span>                                 <span class="c1"># Network subnet</span>
    <span class="l l-Scalar l-Scalar-Plain">prefix</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">16</span>                                        <span class="c1"># Network prefix</span>
    <span class="l l-Scalar l-Scalar-Plain">netmask</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">255.255.0.0</span>                              <span class="c1"># Network netmask, must comply with prefix</span>
    <span class="l l-Scalar l-Scalar-Plain">broadcast</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">10.10.255.255</span>                          <span class="c1"># Broadcast, deduced from subnet and prefix/netmask</span>
    <span class="l l-Scalar l-Scalar-Plain">dhcp_unknown_range</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">10.10.254.1 10.10.254.254</span>     <span class="c1"># This is the range of ip where unknown nodes (i.e. not in the inventory) will be placed if asking for an ip</span>
    <span class="l l-Scalar l-Scalar-Plain">gateway</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">10.10.0.1</span>                                <span class="c1"># Optional, define a gateway</span>
    <span class="l l-Scalar l-Scalar-Plain">is_in_dhcp</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>                                  <span class="c1"># If you want this network to be in the dhcp (only apply to management networks)</span>
    <span class="l l-Scalar l-Scalar-Plain">is_in_dns</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>                                   <span class="c1"># If you want this network to be in the dns</span>
    <span class="l l-Scalar l-Scalar-Plain">services_ip</span><span class="p p-Indicator">:</span>                                      <span class="c1"># IPs or virtual IPs to bind to for each service. In our case, all services will be running on management1 so 10.10.0.1 for all</span>
      <span class="l l-Scalar l-Scalar-Plain">pxe_ip</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">10.10.0.1</span>
      <span class="l l-Scalar l-Scalar-Plain">dns_ip</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">10.10.0.1</span>
      <span class="l l-Scalar l-Scalar-Plain">repository_ip</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">10.10.0.1</span>
      <span class="l l-Scalar l-Scalar-Plain">authentication_ip</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">10.10.0.1</span>
      <span class="l l-Scalar l-Scalar-Plain">time_ip</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">10.10.0.1</span>
      <span class="l l-Scalar l-Scalar-Plain">log_ip</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">10.10.0.1</span>
</pre></div>
</div>
<p>All explanations are given above.</p>
<p>One note for services_ip. It is used if services are spread over multiple managements, or in case of High Availability with virtual IPs. Ansible is not able to gather this information alone from playbooks (it could, but this would end up with a way too much big stack), and so we have to provide it manually. You can also set here an IP from another subnet if your system has network routing.</p>
<p>Then check content of file group_vars/all/networks/interconnect-1.yml . As this is <strong>not</strong> an administration network, its configuration is easy.</p>
<p>That is all for basic networking. General network parameters are set in group_vars/all/networks/ files, and nodes parameters are defined in the node’s files.</p>
<p>Now, let’s have a look at the general configuration.</p>
</div>
<div class="section" id="review-general-configuration">
<h3>5.2.5. Review general configuration<a class="headerlink" href="#review-general-configuration" title="Permalink to this headline">¶</a></h3>
<p>General configuration is made in group_vars/all/general_settings.</p>
<div class="section" id="externals">
<h4>5.2.5.1. Externals<a class="headerlink" href="#externals" title="Permalink to this headline">¶</a></h4>
<p>File group_vars/all/general_settings/external.yml allows to connect cluster to the external world or network. It should be self understandable.</p>
</div>
<div class="section" id="network">
<h4>5.2.5.2. Network<a class="headerlink" href="#network" title="Permalink to this headline">¶</a></h4>
<p>File group_vars/all/general_settings/network.yml allows to configure few network related parameters.</p>
</div>
<div class="section" id="repositories">
<h4>5.2.5.3. Repositories<a class="headerlink" href="#repositories" title="Permalink to this headline">¶</a></h4>
<p>File group_vars/all/general_settings/repositories.yml configure repositories to use for all nodes (using groups and variable precedence, repositories can be tuned for each group of nodes, or even each node).</p>
<p>Right now, only <em>os</em> and <em>bluebanquise</em> are set. This means two repositories will be added to nodes, and they will bind to repository_ip in ice1-1.yml .</p>
</div>
<div class="section" id="nfs">
<h4>5.2.5.4. NFS<a class="headerlink" href="#nfs" title="Permalink to this headline">¶</a></h4>
<p>File group_vars/all/general_settings/nfs.yml allows to set NFS shared folders inside the cluster. Comments in the file should be enough to understand this file.</p>
</div>
<div class="section" id="general">
<h4>5.2.5.5. General<a class="headerlink" href="#general" title="Permalink to this headline">¶</a></h4>
<p>File group_vars/all/general_settings/general.yml configure few main parameters:</p>
<ul class="simple">
<li>Time zone (very important)</li>
</ul>
<p>Do not bother about the other parameters.</p>
<p>And that is all for general configuration. Finally, let’s check the default parameters.</p>
</div>
</div>
<div class="section" id="review-default-parameters">
<h3>5.2.6. Review Default parameters<a class="headerlink" href="#review-default-parameters" title="Permalink to this headline">¶</a></h3>
<p>Last part, and probably the most complicated, are default parameters.</p>
<p>Remember Ansible precedence mechanism. All variables in group_vars/all/ have less priority, while variables in group_vars/* have a higher priority.</p>
<p>The idea here is the following: group_vars/all/all_equipment/ folder contains all the default parameters for all nodes. Here authentication, and equipment_profile. You have to tune these parameters to match your exact “global” need, and then tune dedicated parameters for each equipment group.</p>
<div class="section" id="equipment-profile">
<h4>5.2.6.1. Equipment profile<a class="headerlink" href="#equipment-profile" title="Permalink to this headline">¶</a></h4>
<p>For example, open file /etc/bluebanquise/inventory/group_vars/all/all_equipment/equipment_profile.yml, and check access_control variable. It is set to true:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">equipment_profile</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">access_control</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
</pre></div>
</div>
<p>Ok, but so all nodes will get this value. Let’s check computes nodes, that are in equipment_typeC group. Let’s check c001:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@<span class="o">]</span><span class="c1"># ansible-inventory --host c001 --yaml | grep access_control</span>
  access_control: <span class="nb">true</span>
<span class="o">[</span>root@<span class="o">]</span><span class="c1">#</span>
</pre></div>
</div>
<p>Not good. We need to change that.</p>
<p>Open file group_vars/equipment_typeC/equipment_profile.yml and set access_control to false (line is just commented, uncomment it).</p>
<p>Now check again:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@<span class="o">]</span><span class="c1"># ansible-inventory --host c001 --yaml | grep access_control</span>
  access_control: <span class="nb">false</span>
<span class="o">[</span>root@<span class="o">]</span><span class="c1">#</span>
</pre></div>
</div>
<p>Same apply for all equipment_profile parameters. You define a global one in default, and then tune it for each equipment group.</p>
<p><strong>IMPORTANT</strong>: equipment_profile variable is not standard. It is <strong>STRICTLY FORBIDDEN</strong> to tune it outside default (group_vars/all/all_equipments/equipment_profile.yml) or an equipment group (group_vars/equipment_*). For example, you cannot create a custom group and define some equipment_profile parameters for this group. If you really need to do that, add more equipment groups and tune this way. If you do not respect this rule, unexpected behavior will happen during configuration deployment.</p>
</div>
<div class="section" id="authentication">
<h4>5.2.6.2. Authentication<a class="headerlink" href="#authentication" title="Permalink to this headline">¶</a></h4>
<p>Authentication file allows to define default root password for all nodes, and default public ssh keys lists.</p>
<p>We need to ensure our management1 node ssh public key is set here.</p>
<p>Get the content of /root/.ssh/id_ras.pub and add it in this file. At the same time, <strong>remove the ssh key provided here as example</strong>.</p>
</div>
</div>
<div class="section" id="review-groups-parameters">
<h3>5.2.7. Review groups parameters<a class="headerlink" href="#review-groups-parameters" title="Permalink to this headline">¶</a></h3>
<p>Last step is to check and review example of equipment_profile tuning in each of the group_vars/equipment_XXXXXX folders. Adapt them to your needs.</p>
<p>If you prefer, you can copy the whole group_vars/all/all_equipment/equipment_profile.yml file into these folders, or simply adjust the parameters you wish to change from default.</p>
<p>Once done, configuration is ready.</p>
<p>It is time to deploy configuration on management1.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="deploy_bluebanquise.html" class="btn btn-neutral float-right" title="6. Deploy BlueBanquise" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="learn_ansible.html" class="btn btn-neutral float-left" title="4. Learn Ansible" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Benoît Leveugle, Johnny Keats

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>


<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>2. Vocabulary &mdash; BlueBanquise Documentation 1.0.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'./',
              VERSION:'1.0.1',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="3. Install first management" href="install_first_management.html" />
    <link rel="prev" title="1. Introduction" href="introduction.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> BlueBanquise Documentation
          

          
            
            <img src="_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">1. Introduction</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">2. Vocabulary</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#ansible-vocabulary">2.1. Ansible vocabulary</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#host">2.1.1. Host</a></li>
<li class="toctree-l3"><a class="reference internal" href="#group">2.1.2. Group</a></li>
<li class="toctree-l3"><a class="reference internal" href="#variables">2.1.3. Variables</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#simple">2.1.3.1. Simple</a></li>
<li class="toctree-l4"><a class="reference internal" href="#list">2.1.3.2. List</a></li>
<li class="toctree-l4"><a class="reference internal" href="#dictionary">2.1.3.3. Dictionary</a></li>
<li class="toctree-l4"><a class="reference internal" href="#j2-variables">2.1.3.4. j2 Variables</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#inventory-roles-and-playbooks">2.1.4. Inventory, roles, and playbooks</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#inventory">2.1.4.1. Inventory</a></li>
<li class="toctree-l4"><a class="reference internal" href="#roles">2.1.4.2. Roles</a></li>
<li class="toctree-l4"><a class="reference internal" href="#playbooks">2.1.4.3. Playbooks</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#variables-precedence">2.1.5. Variables precedence</a></li>
<li class="toctree-l3"><a class="reference internal" href="#merge">2.1.6. Merge</a></li>
<li class="toctree-l3"><a class="reference internal" href="#jinja2">2.1.7. Jinja2</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#stack-vocabulary">2.2. Stack vocabulary</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#icebergs">2.2.1. Icebergs</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#one-iceberg-configuration">2.2.1.1. One iceberg configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#multiple-icebergs-configuration">2.2.1.2. Multiple icebergs configuration</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#equipment-profiles">2.2.2. Equipment profiles</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="install_first_management.html">3. Install first management</a></li>
<li class="toctree-l1"><a class="reference internal" href="learn_ansible.html">4. Learn Ansible</a></li>
<li class="toctree-l1"><a class="reference internal" href="configure_bluebanquise.html">5. Configure BlueBanquise</a></li>
<li class="toctree-l1"><a class="reference internal" href="deploy_bluebanquise.html">6. Deploy BlueBanquise</a></li>
<li class="toctree-l1"><a class="reference internal" href="multiple_icebergs.html">7. Manage multiple icebergs</a></li>
<li class="toctree-l1"><a class="reference internal" href="roles.html">8. Roles</a></li>
<li class="toctree-l1"><a class="reference internal" href="references.html">9. References</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">BlueBanquise Documentation</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>2. Vocabulary</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/vocabulary.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="vocabulary">
<h1>2. Vocabulary<a class="headerlink" href="#vocabulary" title="Permalink to this headline">¶</a></h1>
<p>Lets establish few common terms between us before going deeper in technical details.</p>
<p>Some words are important in <strong>BlueBanquise</strong>. Most of them are described here.</p>
<div class="section" id="ansible-vocabulary">
<h2>2.1. Ansible vocabulary<a class="headerlink" href="#ansible-vocabulary" title="Permalink to this headline">¶</a></h2>
<div class="section" id="host">
<h3>2.1.1. Host<a class="headerlink" href="#host" title="Permalink to this headline">¶</a></h3>
<p>An Ansible <strong>host</strong> (also often refered as a <strong>node</strong>) is a remote host managed by Ansible. An <strong>host</strong> can be a physical server, but also a VM or something else.</p>
<p>Hosts are defined in <em>/etc/bluebanquise/inventory/cluster/nodes</em>.</p>
<p>Please do a difference between an Ansible managed host, and a host. All equipment that can have an ip on the network are considered “host”, but only those with an ssh + python capability and on which we will use Ansible to deploy a configuration are considered “Ansible managed host”. They are declared the same way in the stack inventory.</p>
</div>
<div class="section" id="group">
<h3>2.1.2. Group<a class="headerlink" href="#group" title="Permalink to this headline">¶</a></h3>
<p>An Ansible <strong>group</strong> is a logical aggregation of hosts. For example, system administrator can define a group “database_servers” that would contain hosts “database1” and “database2”.</p>
<p><strong>Groups</strong> allow Ansible to provide dedicated <strong>variables</strong> to member hosts or execute tasks on a set of hosts.</p>
<p>Note: a host can be part of multiple groups.</p>
</div>
<div class="section" id="variables">
<h3>2.1.3. Variables<a class="headerlink" href="#variables" title="Permalink to this headline">¶</a></h3>
<p>Variables in Ansible follow the YAML structure.</p>
<p>A variable is like in any programming language: a variable name, and a data related.</p>
<p>Multiple kind of variables exist in Ansible:</p>
<div class="section" id="simple">
<h4>2.1.3.1. Simple<a class="headerlink" href="#simple" title="Permalink to this headline">¶</a></h4>
<p>A simple variable is defined this way:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">my_variable_1</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">hello!</span>
<span class="l l-Scalar l-Scalar-Plain">my_variable_2</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">7777</span>
</pre></div>
</div>
<p>In Jinja2, variable will be accessible directly this way:</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>{{my_variable_1}}
</pre></div>
</div>
<p>Output will be:</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>hello!
</pre></div>
</div>
</div>
<div class="section" id="list">
<h4>2.1.3.2. List<a class="headerlink" href="#list" title="Permalink to this headline">¶</a></h4>
<p>A list is like an array, and can be iterated over:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">my_names_list</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">bob</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">alice</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">henry</span>
</pre></div>
</div>
<p>In Jinja2, variable can be iterated over, or a specific value of the list can be used (like an array):</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>{% for i in my_names_list %}
{{i}}
{% endfor %}
{{my_names_list[0]}}
</pre></div>
</div>
<p>Note that index start at 0.</p>
<p>Output will be:</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>bob
alice
henry
bob
</pre></div>
</div>
<p>Note also that to check if a list is empty, it is possible to check the list itself:</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>{% if my_names_list %}
the list is not empty
{% else %}
the list is empty %}
{% endif %}
</pre></div>
</div>
</div>
<div class="section" id="dictionary">
<h4>2.1.3.3. Dictionary<a class="headerlink" href="#dictionary" title="Permalink to this headline">¶</a></h4>
<p>A dictionary is simply a pack of other variables, defined under it (some kind of variables tree):</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">my_dictionarry_1</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">my_variable_1</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">hello!</span>
  <span class="l l-Scalar l-Scalar-Plain">my_variable_2</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">7777</span>
  <span class="l l-Scalar l-Scalar-Plain">my_names_list</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">bob</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">alice</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">henry</span>
</pre></div>
</div>
<p>In Jinja2, dictionary can be access two ways:</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>{% for i in my_dictionarry_1.my_names_list %}
{{i}}
{% endfor %}
{% for i in my_dictionarry_1[&#39;my_names_list&#39;] %}
{{i}}
{% endfor %}

{{my_dictionarry_1.my_names_list[0]}}
{{my_dictionarry_1[&#39;my_names_list&#39;][0]}}
</pre></div>
</div>
<p>Output will be:</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>bob
alice
henry
bob
alice
henry

bob
bob
</pre></div>
</div>
<p>Jinja2 will be discussed later, do not worry about this point for now.</p>
</div>
<div class="section" id="j2-variables">
<h4>2.1.3.4. j2 Variables<a class="headerlink" href="#j2-variables" title="Permalink to this headline">¶</a></h4>
<p>These are <strong>BlueBanquise</strong> specific variables. All variables with name starting by <strong>j2_</strong> are j2 variables.</p>
<p>These variables are all stored in group_vars/all/j2_variables directory, and are used for the internal purpose of the stack.</p>
<p>These variables are here to simplify tasks and templates writing, by removing ugly and redundant things from them, and providing a direct access to values.
You can consider these variables as “functions” that takes as argument the current running host (or the host provided in hostvars if loaded using hostvars call).</p>
<p>To clarify your mind, you can consider that these variables contains a simple value. In reality, they contain Jinja2 code as a string, that will be interpreted by Ansible during tasks/templates execution, which is why these are more functions/API than pure variables.</p>
<p>Remmeber that in any case, if these variables are not providing the expected value, you can use Ansible variables precedence mechanism to force your values.</p>
<p>Last point, for developers, these j2 variables should be considered as a way to keep compatibility with roles, while upgrading the logic of the stack.</p>
</div>
</div>
<div class="section" id="inventory-roles-and-playbooks">
<h3>2.1.4. Inventory, roles, and playbooks<a class="headerlink" href="#inventory-roles-and-playbooks" title="Permalink to this headline">¶</a></h3>
<div class="section" id="inventory">
<h4>2.1.4.1. Inventory<a class="headerlink" href="#inventory" title="Permalink to this headline">¶</a></h4>
<p>The Ansible inventory is the directory that contains Ansible variables and hosts definitions. In <strong>BlueBanquise</strong>, default path is /etc/bluebanquise/inventory.</p>
<p>Inventory is the <strong>DATA</strong>.</p>
</div>
<div class="section" id="roles">
<h4>2.1.4.2. Roles<a class="headerlink" href="#roles" title="Permalink to this headline">¶</a></h4>
<p>An Ansible role is a list of tasks to do to achieve a purpose. For example, there will be a role called dhcp_server, that contains task to install, configure and start the dhcp server.</p>
<p>In <strong>BlueBanquise</strong>, default path is /etc/bluebanquise/roles.</p>
<p>Note that /etc/bluebanquise/roles is splitted in multiple directories, but ansible.cfg file is configured to use roles in all of them.</p>
<p>Roles are the <strong>AUTOMATION LOGIC</strong>.</p>
</div>
<div class="section" id="playbooks">
<h4>2.1.4.3. Playbooks<a class="headerlink" href="#playbooks" title="Permalink to this headline">¶</a></h4>
<p>An Ansible playbook is simply a list of roles to apply, on a specific host or group of hosts. It is a yaml file.</p>
<p>In <strong>BlueBanquise</strong>, default path is /etc/bluebanquise/playbooks.</p>
<p>Playbooks are your <strong>LIST OF ROLES TO APPLY on your hosts/targets</strong>.</p>
</div>
</div>
<div class="section" id="variables-precedence">
<h3>2.1.5. Variables precedence<a class="headerlink" href="#variables-precedence" title="Permalink to this headline">¶</a></h3>
<p>We are reaching the very important part of the stack.</p>
<p>Ansible has an internal mechanism called <strong>Variables precedence</strong>. Simply put: you can define the same variables (same name) multiple times, and using this mechanism, some definitions will have priority above others, depending of the situation.</p>
<p>When a variable is defined in a yml file, the position of the file in the ansible inventory is key.</p>
<p>For example, a variable defined in /etc/bluebanquise/inventory/group_vars/all/ will have the less precedence, and a variable defined in /etc/bluebanquise/inventory/cluster will have a higher precedence, and so win if loaded.</p>
<p>The full list of available variables precedence is provided in Ansible documentation: <a class="reference external" href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_variables.html#variable-precedence-where-should-i-put-a-variable">variable precedence list</a></p>
<p>This feature is key to the stack and key for system administrator to manipulate the <strong>BlueBanquise</strong> stack the way he/she/(it ?) wants, and <em>force</em> automatic values if desired.</p>
<p>For example, values can be set by default, and then redefined for some groups of hosts without changing the default for all others. Or it can be used to simply fix a dynamic j2 variable to the desired value in hosts definitions if dynamic value is not the one expected. Etc.</p>
<p>Inventory can be seen as a giant pizza, in 3D then flatten.</p>
<ul class="simple">
<li><em>Paste</em> is the variable in /etc/bluebanquise/inventory/group_vars/all</li>
<li>Then <em>large ingredients</em> comes from /etc/bluebanquise/inventory/group_vars/equipment_myequipment</li>
<li>Then <em>small ingredients</em> above are the /etc/bluebanquise/inventory/cluster/nodes/</li>
<li>And <em>pepper and tomatoes</em> (last layer) is the extra-vars at call.</li>
</ul>
<img alt="_images/pizza_example.svg" src="_images/pizza_example.svg" /><p>I like pizza…</p>
</div>
<div class="section" id="merge">
<h3>2.1.6. Merge<a class="headerlink" href="#merge" title="Permalink to this headline">¶</a></h3>
<p>Ansible default hash_behaviour is <em>replace</em>. <strong>BlueBanquise</strong> is using <em>merge</em>.</p>
<p>If using <em>replace</em>, when a dictionary is impacted by the variable’s precedence mechanism, Ansible overwrite the full dictionary if a variable has a higher precedence somewhere.</p>
<p>If using <em>merge</em>, Ansible will only update the related variable, and keep the original dictionary and values for all other variables in this dictionary.</p>
</div>
<div class="section" id="jinja2">
<h3>2.1.7. Jinja2<a class="headerlink" href="#jinja2" title="Permalink to this headline">¶</a></h3>
<p>Jinja2 is the templating language used by Ansible to render templates in roles. It is heavily used in the stack, and learning Jinja2 will often be needed to create custom roles. (But Jinja2 is simple if you are use to code or especially script with bash).</p>
<p>Full documentation is available in a “single page”: <a class="reference external" href="https://jinja.palletsprojects.com/en/2.10.x/templates/">Jinja2 template designer</a></p>
</div>
</div>
<div class="section" id="stack-vocabulary">
<h2>2.2. Stack vocabulary<a class="headerlink" href="#stack-vocabulary" title="Permalink to this headline">¶</a></h2>
<div class="section" id="icebergs">
<h3>2.2.1. Icebergs<a class="headerlink" href="#icebergs" title="Permalink to this headline">¶</a></h3>
<p>Icebergs are logical (and often physical) isolation of ethernet management networks. Most of the time, icebergs are used to:</p>
<ul class="simple">
<li>Spread load over multiple managements servers (for very large clusters). Icebergs are also often called “islands” in these cases.</li>
<li>Secure cluster by dividing specific usages, to prevent compromised system to access all the network.</li>
</ul>
<p>One Iceberg is composed of one or multiple managements servers, <strong>in charge of the same pool of nodes</strong>.</p>
<p><strong>BlueBanquise</strong> support many kinds of configurations, but most common are:</p>
<div class="section" id="one-iceberg-configuration">
<h4>2.2.1.1. One iceberg configuration<a class="headerlink" href="#one-iceberg-configuration" title="Permalink to this headline">¶</a></h4>
<img alt="_images/one_iceberg.svg" src="_images/one_iceberg.svg" /><p>For simple systems (small/medium HPC cluster, small enterprise network, university IT practical session room, etc.), one iceberg scenario is the standard. One or multiple management will reach the same ethernet administration networks, and federate the same pool of nodes.</p>
<img alt="_images/one_iceberg_example_1.svg" src="_images/one_iceberg_example_1.svg" /><img alt="_images/one_iceberg_example_2.svg" src="_images/one_iceberg_example_2.svg" /></div>
<div class="section" id="multiple-icebergs-configuration">
<h4>2.2.1.2. Multiple icebergs configuration<a class="headerlink" href="#multiple-icebergs-configuration" title="Permalink to this headline">¶</a></h4>
<img alt="_images/multiple_icebergs.svg" src="_images/multiple_icebergs.svg" /><p>For advanced systems, (large HPC clusters needing load spreading with unified network, enterprise network, etc.), multiple icebergs scenario can be required. <strong>BlueBanquise</strong> allows multiple levels of icebergs, for complex needs. Also, a global_network can be defined so all nodes from all icebergs can communicate through this unified network (most of the time an Interconnect network).</p>
<img alt="_images/multiple_icebergs_example_1.svg" src="_images/multiple_icebergs_example_1.svg" /></div>
</div>
<div class="section" id="equipment-profiles">
<h3>2.2.2. Equipment profiles<a class="headerlink" href="#equipment-profiles" title="Permalink to this headline">¶</a></h3>
<p>In <strong>BlueBanquise</strong>, nodes are nearly always part of a group starting with prefix <strong>equipment_</strong>. These groups are called <em>equipment profiles</em>.</p>
<p>They are used to provide hosts of this group the <strong>equipment_profile</strong> dictionary (this dictionary defines hosts operating system parameters, kernel parameters, partitioning, etc.), and other variables if needed like dedicated authentication parameters.</p>
<p>These are key groups of the stack.</p>
<p><strong>It is important</strong> to note that equipment_profiles dictionary <strong>must not</strong> be used at an upper level than group_vars in variables precedence. <strong>It can, but you must NOT</strong>.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="install_first_management.html" class="btn btn-neutral float-right" title="3. Install first management" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="introduction.html" class="btn btn-neutral float-left" title="1. Introduction" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Benoît Leveugle, Johnny Keats

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>